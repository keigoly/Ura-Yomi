# 請求先アカウントの設定ガイド

## 概要

Google Cloudプロジェクトに請求先アカウントをリンクすることで、APIの有料機能を使用できるようになります。無料枠を超える使用量がある場合や、本番運用を開始する前に設定することを推奨します。

## 請求先アカウントをリンクするタイミング

### ✅ 今すぐリンクすべき場合

- 本番環境で運用を開始する
- 無料枠を超える使用量が見込まれる
- 月額1,000円の上限を想定した運用を開始する
- クレジット購入機能を実際に使用する

### ⏳ 後でリンクしても良い場合

- 開発・テスト段階で無料枠内で運用する
- 小規模なテストのみを行う
- 使用量が少なく、無料枠内で収まる見込み

## 請求先アカウントのリンク方法

### ステップ1: Google Cloud Consoleにアクセス

1. [Google Cloud Console](https://console.cloud.google.com/) にアクセス
2. プロジェクト `tubeinsight-ai` を選択

### ステップ2: 請求先アカウントページに移動

1. 左側のメニューから **「お支払い」** → **「リンクされたアカウント」** を選択
2. または、画面上部の検索バーで「請求」と検索

### ステップ3: 請求先アカウントをリンク

1. **「請求先アカウントをリンク」** ボタンをクリック
2. 既存の請求先アカウントがある場合：
   - ドロップダウンから選択
   - **「リンク」** をクリック
3. 請求先アカウントがない場合：
   - **「請求先アカウントを作成」** をクリック
   - 請求先アカウント名を入力
   - 国/地域を選択
   - 請求先情報（クレジットカード等）を入力
   - **「送信して請求先アカウントを作成」** をクリック

### ステップ4: 確認

1. リンクが完了すると、プロジェクトに請求先アカウントが表示されます
2. **「APIとサービス」** → **「ダッシュボード」** で使用量を確認できるようになります

## 無料枠の確認

### YouTube Data API

- **無料枠**: 1日10,000ユニットまで無料
- **計算**: 1コメント取得 ≈ 1ユニット
- **例**: 1日10,000コメントまで無料で取得可能

### Gemini API

- **無料枠**: モデルによって異なります
- **確認方法**: [Google AI Studio](https://aistudio.google.com/) で確認
- **一般的**: 1分あたり15リクエスト、1日あたり1,500リクエストまで無料（モデルにより異なる）

## 無料枠内で運用する場合

請求先アカウントをリンクしなくても、以下の条件を満たせば無料で使用できます：

1. **YouTube Data API**: 1日10,000ユニット以内
2. **Gemini API**: 無料枠内

### 推奨設定

無料枠内で運用する場合の推奨設定：

```env
# サーバー側の制限
DAILY_LIMIT_PER_USER=3  # 1ユーザーあたり1日3回まで
MAX_COMMENTS_PER_ANALYSIS=2000  # 1回あたり2,000コメントまで
```

この設定で、1日10,000ユニット以内に収まります。

## 請求先アカウントをリンクした後の注意事項

1. **予算アラートの設定**: 予期しない課金を防ぐため、予算アラートを設定することを推奨します
2. **使用量の監視**: 定期的に使用量を確認し、無料枠を超えていないか確認
3. **月額上限の管理**: サーバー側で月額1,000円の上限を設定していますが、Google Cloud側でも予算を設定することを推奨します

## 予算アラートの設定（推奨）

1. Google Cloud Consoleで **「お支払い」** → **「予算とアラート」** を選択
2. **「予算を作成」** をクリック
3. 予算名を入力（例: `tubeinsight-ai-monthly-budget`）
4. 予算額を設定（例: 1,000円）
5. アラートを設定（例: 50%、90%、100%で通知）
6. **「作成」** をクリック

## まとめ

- **開発・テスト段階**: 無料枠内で運用する場合は、請求先アカウントのリンクは後回しでもOK
- **本番運用開始時**: 請求先アカウントをリンクし、予算アラートを設定することを推奨
- **月額1,000円の上限**: サーバー側で制御していますが、Google Cloud側でも予算を設定するとより安全です

<!-- Updated -->
