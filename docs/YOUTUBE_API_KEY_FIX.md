# YouTube APIキーのリファラー制限エラー修正ガイド

## エラーメッセージ

```
YouTube API Error: Requests from referer <empty> are blocked.
```

## 原因

サーバー側からYouTube APIを呼び出す場合、リファラー（referer）ヘッダーが含まれません。しかし、APIキーに「HTTPリファラー（ウェブサイト）」の制限が設定されているため、リファラーがないリクエストがブロックされています。

## 解決方法

### 方法1: APIキーの制限を変更する（推奨）

1. [Google Cloud Console](https://console.cloud.google.com/) にアクセス
2. プロジェクトを選択
3. **「APIとサービス」** → **「認証情報」** を選択
4. **「YouTube Data API キー」** をクリック
5. **「APIキーの制限」** セクションで、以下のいずれかを選択：

#### オプションA: 制限を削除（開発環境）

1. **「アプリケーションの制限」** で **「なし」** を選択
2. **「保存」** をクリック

⚠️ **注意**: 開発環境でのみ使用してください。本番環境では推奨されません。

#### オプションB: IPアドレス制限を使用（推奨）

1. **「アプリケーションの制限」** で **「IPアドレス（ウェブサーバー、cronジョブなど）」** を選択
2. **「IPアドレスを追加」** をクリック
3. サーバーのIPアドレスを入力
   - **重要**: エラーメッセージに表示されているIPアドレス（例: `106.73.31.64`）を追加してください
   - ローカル開発環境の場合: `127.0.0.1` または実際の外部IPアドレス
   - 本番環境の場合: サーバーの実際のIPアドレス
4. **「保存」** をクリック

⚠️ **注意**: エラーメッセージに表示されているIPアドレス（`106.73.31.64`）を必ず許可リストに追加してください。

#### オプションC: リファラー制限を削除

1. **「アプリケーションの制限」** で **「HTTPリファラー（ウェブサイト）」** が選択されている場合
2. すべてのリファラーを削除するか、**「なし」** に変更
3. **「保存」** をクリック

### 方法2: 別のAPIキーを作成する（推奨）

サーバー用とクライアント用でAPIキーを分けることを推奨します：

1. **「認証情報を作成」** → **「APIキー」** を選択
2. 名前を「YouTube Data API キー（サーバー用）」などに設定
3. **「アプリケーションの制限」** で **「IPアドレス（ウェブサーバー、cronジョブなど）」** を選択
4. サーバーのIPアドレスを追加
5. **「APIの制限」** で **「YouTube Data API v3」** のみを選択
6. **「作成」** をクリック
7. 新しいAPIキーを`server/.env`の`YOUTUBE_API_KEY`に設定

## 確認方法

修正後、サーバーを再起動して、再度解析を実行してください。エラーが解消されれば成功です。

## トラブルシューティング

### まだエラーが発生する場合

1. APIキーの変更が反映されるまで数分かかる場合があります
2. サーバーを再起動してください
3. ブラウザのキャッシュをクリアしてください

### 本番環境での注意事項

- 本番環境では、必ずIPアドレス制限を使用してください
- APIキーは絶対に公開しないでください
- 定期的にAPIキーをローテーションしてください
